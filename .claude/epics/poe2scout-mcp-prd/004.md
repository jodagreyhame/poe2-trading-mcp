# Basic Price Checking Tools

**Status**: open  
**Created**: 2025-08-21T03:01:30Z  
**Updated**: 2025-08-21T03:01:30Z  
**GitHub**: [Will be updated when synced to GitHub]

---

**Dependencies**: [002, 003]  
**Parallel**: true  
**Conflicts with**: none  
**Size**: M (16 hours)

## Description

Implement the core MCP tools for price checking functionality, including item price lookups and currency rate conversions. This establishes the foundational trading intelligence capabilities of the POE2Scout system.

## Acceptance Criteria

- [ ] `get_item_price` MCP tool implemented with proper parameter validation
- [ ] `get_currency_rates` MCP tool implemented for POE2 currency conversions
- [ ] Response formatting utilities created for consistent data presentation
- [ ] Error handling implemented for API failures and invalid requests
- [ ] Tool schemas properly defined with comprehensive parameter documentation
- [ ] Integration tests created for both price checking tools
- [ ] Rate limiting implemented to respect POE trading API limits
- [ ] Mock data available for development and testing without API calls

## Technical Details

### Implementation Approach

1. **get_item_price Tool**
   - Accept item name, base type, and optional modifiers as parameters
   - Query POE trading APIs for current market prices
   - Return price statistics (min, max, average, median)
   - Include confidence scores based on sample size

2. **get_currency_rates Tool**
   - Fetch current currency exchange rates from POE APIs
   - Support major currencies (Chaos Orb, Divine Orb, Exalted Orb, etc.)
   - Return normalized exchange rates with timestamps
   - Cache rates for short periods to reduce API calls

3. **Response Formatting**
   - Create standardized response schemas for price data
   - Implement currency formatting utilities
   - Add data validation and sanitization functions
   - Support multiple output formats (compact, detailed, raw)

4. **Error Handling Strategy**
   - Graceful degradation when APIs are unavailable
   - Clear error messages for invalid item names or parameters
   - Retry logic for transient network failures
   - Fallback to cached data when appropriate

### Tool Schemas

```typescript
interface GetItemPriceParams {
  itemName: string;
  baseType?: string;
  league?: string;
  modifiers?: string[];
  maxResults?: number;
}

interface GetCurrencyRatesParams {
  baseCurrency?: string;
  targetCurrencies?: string[];
  league?: string;
}
```

### File Structure
```
src/
├── tools/
│   ├── get_item_price.ts
│   ├── get_currency_rates.ts
│   └── index.ts
├── utils/
│   ├── formatting.ts
│   ├── validation.ts
│   └── api_client.ts
└── types/
    ├── price_data.ts
    └── currency_data.ts
```

### Key Components
- POE trading API client with proper authentication
- Price data normalization and statistical analysis
- Currency conversion utilities
- Response caching for improved performance
- Comprehensive input validation

## Dependencies

**Depends on**:
- [002] - Core MCP Server Structure: Requires server framework and tool registration system
- [003] - POE2 API Integration Setup: Requires API client configuration and authentication

**Enables**:
- [006] - Trade Evaluation Tools: Provides price data for trade analysis

## Effort Estimate

**Size**: Medium (16 hours)
- get_item_price tool implementation: 6 hours
- get_currency_rates tool implementation: 4 hours
- Response formatting and validation utilities: 3 hours
- Testing and error handling: 3 hours

## Definition of Done

- [ ] Both MCP tools successfully registered and callable
- [ ] Tools return properly formatted price and currency data
- [ ] Error handling covers all expected failure scenarios
- [ ] Integration tests pass with mock API responses
- [ ] Rate limiting prevents API abuse
- [ ] Documentation includes usage examples and parameter descriptions
- [ ] Code follows TypeScript best practices with proper typing
- [ ] Tools work correctly in isolation and integrated with server